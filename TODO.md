# DLMS/COSEM 项目待办事项清单

本文档记录了DLMS/COSEM Rust实现项目的所有待办事项，按模块和优先级分类。

**最后更新**: 2025-01-XX

---

## 📊 总体进度

- **已完成**: 核心协议栈（传输层、会话层、安全层、应用层基础功能）
- **进行中**: 服务器实现、xDLMS高级功能
- **待实现**: 接口类、高级功能、优化

---

## 🔴 高优先级（核心功能）

### 1. 应用层 (dlms-application)

#### 访问选择器
- [ ] **完整的访问选择器支持**
  - [ ] 日期范围选择器
  - [ ] 入口选择器
  - [ ] 值范围选择器
  - [ ] 其他复杂选择器类型

### 2. 会话层 (dlms-session)

#### HDLC 高级功能
- [ ] **服务器端SNRM/UA握手实现**
  - [ ] 等待SNRM帧
  - [ ] 解析SNRM参数
  - [ ] 生成UA响应
  - [ ] 发送UA帧
  - 位置: `dlms-server/src/listener.rs`

- [ ] **请求解析和路由**
  - [ ] PDU类型识别
  - [ ] 路由到相应的处理方法（GET/SET/ACTION）
  - [ ] 生成和发送响应
  - 位置: `dlms-server/src/listener.rs`

### 3. 安全层 (dlms-security)

#### xDLMS 加密帧
- [ ] **加密帧构建和解析**
  - [ ] Security Control字节处理
  - [ ] System Title嵌入
  - [ ] Frame Counter嵌入
  - [ ] 加密数据封装
  - [ ] 解密帧解析

- [ ] **帧计数器验证**
  - [ ] 接收帧的计数器验证
  - [ ] 重放攻击检测
  - [ ] 计数器同步机制

- [ ] **KDF算法完善**
  - [ ] 实现完整的DLMS标准KDF算法
  - [ ] 参考Green Book中的KDF规范
  - [ ] 替换当前简化实现

---

## 🟡 中优先级（重要功能）

### 1. 服务器 (dlms-server)

#### 连接管理
- [ ] **多客户端连接管理完善**
  - [ ] 连接池管理
  - [ ] 连接状态跟踪
  - [ ] 连接超时处理
  - [ ] 优雅关闭

- [ ] **服务器状态管理**
  - [ ] 服务器状态机
  - [ ] 启动/停止流程
  - [ ] 状态转换验证

#### 请求处理
- [ ] **请求验证和授权**
  - [ ] 访问控制列表（ACL）
  - [ ] 权限验证
  - [ ] 安全策略检查

- [ ] **Get Request Next/WithList 完整支持**
  - [ ] 块传输处理
  - [ ] 多属性请求处理
  - [ ] 响应组装

- [ ] **Short Name 寻址支持**
  - [ ] base_name到OBIS码映射
  - [ ] SN寻址请求处理

#### 事件处理
- [ ] **事件通知生成**
  - [ ] 事件触发机制
  - [ ] 事件数据构建

- [ ] **事件订阅管理**
  - [ ] 订阅注册
  - [ ] 订阅列表管理

- [ ] **事件推送机制**
  - [ ] 异步事件推送
  - [ ] 推送队列管理

#### 高级功能
- [ ] **服务器统计信息**
  - [ ] 请求计数
  - [ ] 错误统计
  - [ ] 性能指标

- [ ] **并发请求处理**
  - [ ] 请求队列
  - [ ] 并发控制
  - [ ] 资源管理

### 2. 客户端 (dlms-client)

#### 高级功能
- [ ] **对象浏览功能**
  - [ ] 对象列表获取
  - [ ] 对象树遍历
  - [ ] 对象信息查询

- [ ] **数据读取功能**
  - [ ] 批量数据读取
  - [ ] 数据缓存
  - [ ] 数据格式化

- [ ] **数据写入功能**
  - [ ] 批量数据写入
  - [ ] 写入验证
  - [ ] 回滚机制

- [ ] **方法调用功能**
  - [ ] 方法参数验证
  - [ ] 返回值处理
  - [ ] 错误处理

- [ ] **事件通知处理**
  - [ ] 事件监听
  - [ ] 事件过滤
  - [ ] 事件回调

#### 连接管理
- [ ] **连接池管理**
  - [ ] 连接复用
  - [ ] 连接生命周期管理
  - [ ] 连接健康检查

- [ ] **自动重连机制**
  - [ ] 连接断开检测
  - [ ] 自动重连策略
  - [ ] 重连次数限制

- [ ] **请求/响应超时处理**
  - [ ] 可配置超时时间
  - [ ] 超时重试机制
  - [ ] 超时回调

- [ ] **并发请求支持**
  - [ ] 请求队列
  - [ ] 并发控制
  - [ ] 请求去重

- [ ] **请求队列管理**
  - [ ] 优先级队列
  - [ ] 队列大小限制
  - [ ] 队列监控

- [ ] **客户端配置管理**
  - [ ] 配置文件支持
  - [ ] 配置验证
  - [ ] 配置热重载

### 3. 安全层 (dlms-security)

#### 认证功能
- [ ] **认证挑战-响应流程**
  - [ ] 挑战生成
  - [ ] 响应验证
  - [ ] 认证状态管理

- [ ] **密钥协商机制**
  - [ ] 密钥交换协议
  - [ ] 密钥验证
  - [ ] 密钥更新

- [ ] **认证状态管理**
  - [ ] 认证状态跟踪
  - [ ] 状态转换
  - [ ] 状态验证

#### 密钥管理
- [ ] **密钥存储和管理**
  - [ ] 密钥存储接口
  - [ ] 密钥加密存储
  - [ ] 密钥访问控制

- [ ] **密钥更新机制**
  - [ ] 密钥轮换
  - [ ] 密钥同步
  - [ ] 密钥撤销

- [ ] **主密钥（KEK）管理**
  - [ ] KEK生成
  - [ ] KEK分发
  - [ ] KEK更新

- [ ] **密钥导出和导入**
  - [ ] 密钥导出格式
  - [ ] 密钥导入验证
  - [ ] 密钥迁移

#### 安全套件
- [ ] **安全套件协商**
  - [ ] 套件列表交换
  - [ ] 套件选择算法
  - [ ] 套件验证

- [ ] **安全参数验证**
  - [ ] 参数完整性检查
  - [ ] 参数范围验证
  - [ ] 参数兼容性检查

### 4. ISO-ACSE (dlms-asn1)

#### 高级功能
- [ ] **ApplicationContextNameList 完整实现**
  - [ ] SEQUENCE OF编码/解码
  - [ ] 列表验证

- [ ] **AssociateSourceDiagnostic 完整 CHOICE 支持**
  - [ ] 所有CHOICE变体
  - [ ] 变体编码/解码

- [ ] **AcseServiceUser 和 AcseServiceProvider 枚举**
  - [ ] 枚举定义
  - [ ] 编码/解码

- [ ] **APTitle Form 1 支持**
  - [ ] Form 1编码/解码
  - [ ] Form 1/2转换

- [ ] **AEQualifier Form 1 支持**
  - [ ] Form 1编码/解码
  - [ ] Form 1/2转换

- [ ] **AuthenticationValue 完整 CHOICE 支持**
  - [ ] 所有CHOICE变体
  - [ ] 变体编码/解码

- [ ] **常用认证机制 OID 常量**
  - [ ] OID常量定义
  - [ ] OID验证函数

- [ ] **ACSE Requirements 位定义**
  - [ ] 位定义常量
  - [ ] 位操作函数

- [ ] **ACSE 错误处理增强**
  - [ ] 详细错误信息
  - [ ] 错误恢复机制

---

## 🟢 低优先级（增强功能）

### 1. 会话层 (dlms-session)

#### HDLC 优化
- [ ] **HDLC 错误恢复机制**
  - [ ] 错误检测
  - [ ] 自动恢复
  - [ ] 错误报告

#### Wrapper 优化
- [ ] **Wrapper 连接建立流程**
  - [ ] 连接握手
  - [ ] 参数协商

- [ ] **Wrapper 错误处理**
  - [ ] 错误检测
  - [ ] 错误恢复

#### 通用功能
- [ ] **会话状态管理**
  - [ ] 状态机实现
  - [ ] 状态转换验证

- [ ] **多会话支持**
  - [ ] 会话标识
  - [ ] 会话管理
  - [ ] 会话隔离

### 2. 传输层 (dlms-transport)

#### TCP 优化
- [ ] **连接池管理**
  - [ ] 连接复用
  - [ ] 连接生命周期

- [ ] **自动重连机制**
  - [ ] 重连策略
  - [ ] 重连次数限制

- [ ] **超时处理优化**
  - [ ] 可配置超时
  - [ ] 超时回调

#### UDP 优化
- [ ] **数据包分片和重组**
  - [ ] 分片处理
  - [ ] 重组逻辑

- [ ] **数据包丢失检测**
  - [ ] 丢失检测
  - [ ] 重传机制

#### Serial 优化
- [ ] **串口参数自动检测**
  - [ ] 波特率检测
  - [ ] 数据位检测

- [ ] **流控制支持**
  - [ ] RTS/CTS支持
  - [ ] XON/XOFF支持

- [ ] **多串口设备管理**
  - [ ] 设备枚举
  - [ ] 设备选择

#### 通用功能
- [ ] **传输层统计信息**
  - [ ] 字节计数
  - [ ] 错误统计
  - [ ] 性能指标

- [ ] **连接状态监控**
  - [ ] 状态跟踪
  - [ ] 状态通知

- [ ] **错误恢复机制**
  - [ ] 自动恢复
  - [ ] 错误报告

### 3. ASN.1 (dlms-asn1)

#### A-XDR 优化
- [ ] **CompactArray 完整编码/解码支持**
  - [ ] 编码实现
  - [ ] 解码实现
  - [ ] 测试覆盖

- [ ] **长度编码优化（支持长格式）**
  - [ ] 长格式支持
  - [ ] 编码优化

- [ ] **错误处理和恢复机制**
  - [ ] 错误检测
  - [ ] 部分解码
  - [ ] 错误恢复

#### COSEM ASN.1
- [ ] **生成 COSEM ASN.1 结构定义**
  - [ ] 结构生成工具
  - [ ] 结构定义

- [ ] **实现 COSEM 对象标识符编码/解码**
  - [ ] OID编码
  - [ ] OID解码

- [ ] **实现 COSEM 方法调用编码/解码**
  - [ ] 方法编码
  - [ ] 方法解码

- [ ] **实现 COSEM 属性访问编码/解码**
  - [ ] 属性编码
  - [ ] 属性解码

### 4. 接口类 (dlms-interface)

#### 核心接口类
- [ ] **Data 接口类（Class ID: 1）**
- [ ] **Register 接口类（Class ID: 3）**
- [ ] **Extended Register 接口类（Class ID: 4）**
- [ ] **Demand Register 接口类（Class ID: 5）**
- [ ] **Profile Generic 接口类（Class ID: 7）**
- [ ] **Clock 接口类（Class ID: 8）**
- [ ] **Association Short Name 接口类（Class ID: 12）**
- [ ] **Association Logical Name 接口类（Class ID: 15）**
- [ ] **Security Setup 接口类（Class ID: 64）**

#### 其他接口类
- [ ] Register Activation（Class ID: 6）
- [ ] Script Table（Class ID: 9）
- [ ] Schedule（Class ID: 10）
- [ ] Special Days Table（Class ID: 11）
- [ ] SAP Assignment（Class ID: 17）
- [ ] Image Transfer（Class ID: 18）
- [ ] IEC Local Port Setup（Class ID: 19）
- [ ] Activity Calendar（Class ID: 20）
- [ ] Register Monitor（Class ID: 21）
- [ ] Single Action Schedule（Class ID: 22）
- [ ] IEC HDLC Setup（Class ID: 23）
- [ ] IEC twisted pair setup（Class ID: 24）
- [ ] MBus Slave Port Setup（Class ID: 25）
- [ ] Disconnect Control（Class ID: 70）
- [ ] Limiter（Class ID: 71）
- [ ] Push Setup（Class ID: 40）

#### 接口类基础设施
- [ ] **属性处理**
  - [ ] 属性访问器实现
  - [ ] 属性值验证
  - [ ] 属性访问权限检查

- [ ] **方法处理**
  - [ ] 方法调用实现
  - [ ] 方法参数验证
  - [ ] 方法返回值处理

- [ ] **宏系统**
  - [ ] 接口类定义宏
  - [ ] 属性定义宏
  - [ ] 方法定义宏

### 5. 核心模块 (dlms-core)

#### 数据类型
- [ ] **完善数据类型单元测试**
  - [ ] 所有数据类型测试
  - [ ] 边界条件测试
  - [ ] 错误情况测试

- [ ] **实现更多 COSEM 日期/时间格式支持**
  - [ ] 其他日期格式
  - [ ] 时区支持
  - [ ] 夏令时支持

- [ ] **添加数据类型验证和约束检查**
  - [ ] 范围验证
  - [ ] 格式验证
  - [ ] 约束检查

- [ ] **实现 OBIS 代码解析和验证工具**
  - [ ] OBIS解析器
  - [ ] OBIS验证器
  - [ ] OBIS格式化

- [ ] **添加数据类型转换工具函数**
  - [ ] 类型转换
  - [ ] 格式化函数
  - [ ] 解析函数

---

## 📝 优化和增强

### 性能优化
- [ ] **内存优化**
  - [ ] 零拷贝操作
  - [ ] 内存池
  - [ ] 缓冲区复用

- [ ] **编码/解码优化**
  - [ ] 编码缓存
  - [ ] 批量操作
  - [ ] SIMD优化

- [ ] **并发优化**
  - [ ] 无锁数据结构
  - [ ] 并发控制优化
  - [ ] 资源池管理

### 代码质量
- [ ] **测试覆盖**
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] 性能测试
  - [ ] 模糊测试

- [ ] **文档完善**
  - [ ] API文档
  - [ ] 使用示例
  - [ ] 架构文档
  - [ ] 协议文档

- [ ] **错误处理增强**
  - [ ] 详细错误信息
  - [ ] 错误恢复机制
  - [ ] 错误日志

### 工具和基础设施
- [ ] **开发工具**
  - [ ] 调试工具
  - [ ] 性能分析工具
  - [ ] 协议分析工具

- [ ] **CI/CD**
  - [ ] 自动化测试
  - [ ] 代码质量检查
  - [ ] 自动化构建
  - [ ] 发布流程

- [ ] **示例和教程**
  - [ ] 基础示例
  - [ ] 高级示例
  - [ ] 最佳实践
  - [ ] 故障排除指南

---

## 📅 优先级说明

- **🔴 高优先级**: 核心功能，影响基本使用
- **🟡 中优先级**: 重要功能，提升用户体验
- **🟢 低优先级**: 增强功能，优化和扩展

---

## 📌 近期重点（Next Sprint）

1. **服务器端SNRM/UA握手实现** (高优先级)
2. **请求解析和路由** (高优先级)
3. **加密帧构建和解析** (高优先级)
4. **帧计数器验证** (高优先级)
5. **完整的访问选择器支持** (高优先级)

---

## 📊 统计信息

- **总待办事项**: ~150项
- **高优先级**: ~15项
- **中优先级**: ~60项
- **低优先级**: ~75项

---

## 🔄 更新历史

- 2025-01-XX: 初始TODO清单创建
- 定期更新: 根据开发进度更新状态
